<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#062e3f">
    <meta name="Description" content="Laptop Borrowing Kiosk">

    <!-- Google Font: Work Sans -->
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css" />

    <title>Laptop Kiosk</title>

    <style>
        body {
            font-family:monospace;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        #header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 {
            font-family:monospace;
            font-size: 100px;
            color: #ffffff;
        }
        .buttons {
            display: flex;
            justify-content: center;
            gap: 30px;
        }
        .button {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #007BFF;
            color: white;
            font-size: 3.5rem;
            font-family:monospace;
            font-weight: bold;
            border: none;
            padding: 20px 40px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 400px;
            height: 180px;
        }
        .button i {
            margin-right: 15px;
            font-size: 2rem;
        }
        .button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }
        .button.return {
            background-color: #e74c3c;
        }
        .button.return:hover {
            background-color: #c0392b;
        }
        .bg {
            animation:slide 3s ease-in-out infinite alternate;
            background-image: linear-gradient(-60deg, #6c3 50%, #09f 50%);
            bottom:0;
            left:-50%;
            opacity:.5;
            position:fixed;
            right:-50%;
            top:0;
            z-index:-1;
        }

        .bg2 {
          animation-direction:alternate-reverse;
          animation-duration:4s;
        }

        .bg3 {
          animation-duration:5s;
        }

        @keyframes slide {
          0% {
            transform:translateX(-25%);
          }
          100% {
            transform:translateX(25%);
          }
        }
    </style>
</head>

<body>
<div class="bg"></div>
<div class="bg bg2"></div>
<div class="bg bg3"></div>
    <div id="header">
        <h1>Laptop Kiosk</h1>
    </div>

    <div class="buttons">
        <button class="button take" onclick="handleTake()">
            <i class="fas fa-laptop"></i> Take a Laptop
        </button>
        <button class="button return" onclick="handleReturn()">
            <i class="fas fa-undo-alt"></i> Return a Laptop
        </button>
    </div>

    <script>
        let inactivityTimer;

        // Function to reset the inactivity timer
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(function() {
                fetch('/clear_session', { method: 'POST' })  // ?????????? ?????? ?? ??????? ??????
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            window.location.href = "/";  // ????? ???????? ??????? ???? ?? ???????
                        }
                    });
            }, 5000);  // 5 ??????f
        }

        // Call resetInactivityTimer on page load
        window.onload = resetInactivityTimer;

        function handleTake() {
            resetInactivityTimer();

    // Fetch the available laptop count from the server
    fetch('/get_laptop_status')
        .then(response => response.json())
        .then(data => {
            const availableLaptops = data.laptop_count.split('/')[0]; // Get available laptops from "X/Total"

            if (parseInt(availableLaptops) > 0) {
                // If there are laptops available, proceed with the redirection
                fetch('/send_arduino_signal', { method: 'POST' });
                const uid = '';  // Example UID, update this with the actual selected UID
                localStorage.setItem('selectedUID', uid);
                window.location.href = "/scan_page";  // Redirect to scan_page
            } else {
                // If no laptops are available, show an alert
                Swal.fire({
                    icon: 'info',
                    title: '???? ????',
                    text: '??? ??????? ???? ?????????????',
                    showCancelButton: false,
                    toast: true,
                    position: 'top-end'
                });

            }
        })
        .catch(error => {
            console.error('Error fetching laptop status:', error);
            alert('An error occurred while checking laptop availability.');
        });
}


        function handleReturn() {
            resetInactivityTimer();
        // Send a request to the server to check if the user has borrowed any laptops
        fetch('/check_user_laptops', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // If the user has borrowed laptops, redirect to the return page
                fetch('/send_arduino_signal', { method: 'POST' });
                window.location.href = "/return_page";  // Redirect to return_page instead of scan_page
            } else {
                // Display an error message if the user hasn't borrowed any laptops
                alert(data.message);
            }
        })
        .catch(error => {
            console.error('Error checking user laptops:', error);
            alert('An error occurred while checking your borrowed laptops.');
        });
    }
        window.onmousemove = resetInactivityTimer;
        window.onkeypress = resetInactivityTimer;
    </script>
</body>
</html>
